# 機能要件 (Functional Requirements)

## 1. 概要

整数の四則演算を行うWeb電卓アプリケーションを開発する。演算子の優先順位を考慮し、括弧による演算順序の制御をサポートする。

## 2. 基本機能

### 2.1 四則演算

- **加算 (+)**: 2つの整数を加算する
- **減算 (-)**: 2つの整数を減算する
- **乗算 (×)**: 2つの整数を乗算する
- **除算 (÷)**: 2つの整数を除算する（整数除算）

### 2.2 演算ルール

- **演算子の優先順位**: 乗算(×)と除算(÷)は加算(+)と減算(-)より優先される
  - 例: `2 + 3 × 4 = 14`（`(2 + 3) × 4 = 20` ではない）
- **括弧のサポート**: `(` と `)` を使用して演算順序を明示的に制御可能
  - 例: `(2 + 3) × 4 = 20`
- **整数のみ対応**: 小数点の入力および計算は非対応
- **負の数の入力不可**: 負の数を直接入力することはできない（計算結果として負の数になることは許容）

## 3. UI要素

### 3.1 必須ボタン

- **数字ボタン**: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9
- **演算子ボタン**: + (加算), - (減算), × (乗算), ÷ (除算)
- **括弧ボタン**: ( (開き括弧), ) (閉じ括弧)
- **等号ボタン**: = (計算実行)
- **ACボタン**: All Clear（全ての入力と演算結果をクリア）
- **Delボタン**: Delete（最後の1文字を削除、バックスペース的な動作）

### 3.2 表示エリア

#### メイン表示
- **計算式表示**: 入力中の計算式全体を表示
  - 例: ユーザーが `5 + 3 × 2` と入力している途中の状態を表示
- **結果表示**: `=` を押した後の計算結果を表示
  - 例: `5 + 3 × 2 = 11`

#### 計算履歴表示
- 過去の計算履歴を表示（新しいものから順に）
- 表示件数: デフォルト5件（環境変数で変更可能）
- 表示形式: `計算式 = 結果` の形式
  - 例: 
    ```
    15 ÷ 3 = 5
    (2 + 3) × 4 = 20
    10 - 5 = 5
    ```

### 3.3 レイアウト

- 一般的な電卓のボタン配置を採用
- デザイン: モダンでシンプルな見た目
- レスポンシブデザインは不要（PC環境を想定）

## 4. 表示制約

### 4.1 桁数制限

- **表示可能桁数**: デフォルトで10桁（10^10 - 1 = 9,999,999,999 まで）
- **環境変数による変更**: `REACT_APP_MAX_DIGITS` で桁数上限を設定可能
- **桁あふれ時の動作**: 桁数を超えた場合はエラーを表示

### 4.2 計算履歴の保存件数

- **デフォルト件数**: 5件
- **環境変数による変更**: `REACT_APP_HISTORY_COUNT` で保存件数を設定可能

## 5. 操作フロー

### 5.1 基本的な計算フロー

1. ユーザーが数字と演算子を入力
2. 計算式がメイン表示エリアに表示される
3. `=` ボタンを押すと計算が実行される
4. 結果がメイン表示エリアに表示される
5. 計算履歴に追加される

### 5.2 連続演算

- **計算結果からの続行**: `=` で計算を実行した後、演算子を押すと計算結果を使って続行可能
  - 例: `5 + 3 = 8` の後、`+ 2` と入力すると `8 + 2` として計算続行
- **`=` の連打機能は不要**: `5 + 3 = = =` のような操作は実装しない

### 5.3 クリア操作

- **ACボタン**: 全ての入力をクリアし、初期状態に戻る
  - 計算式、結果、入力中の値を全てクリア
  - 計算履歴はクリアされない
- **Delボタン**: 入力中の計算式の最後の1文字を削除
  - 何も入力されていない場合は無効

## 6. キーボード操作

電卓操作をキーボードからも実行可能にする。

### 6.1 キーマッピング

- **数字キー (0-9)**: 対応する数字を入力
- **演算子キー**: 
  - `+` キー: 加算
  - `-` キー: 減算
  - `*` キー: 乗算（`×` として扱う）
  - `/` キー: 除算（`÷` として扱う）
- **括弧キー**:
  - `(` キー: 開き括弧
  - `)` キー: 閉じ括弧
- **Enter キー**: `=` (計算実行)
- **Escape キー**: AC（全クリア）
- **Backspace キー**: Del（1文字削除）

## 7. エラーハンドリング

### 7.1 ゼロ除算エラー

- **発生条件**: 0で割ろうとした場合（例: `5 ÷ 0`）
- **動作**: 
  - エラーメッセージを表示（例: "Error: Division by zero"）
  - 入力状態をリセット（ACと同様の動作）

### 7.2 桁あふれエラー

- **発生条件**: 計算結果が表示可能桁数を超えた場合
- **動作**: 
  - エラーメッセージを表示（例: "Error: Number too large"）
  - ユーザーに通知

### 7.3 不正入力エラー

- **発生条件**: 
  - 括弧の対応が不正（例: `(5 + 3`、`5 + 3)`）
  - 演算子が連続（例: `5 + + 3`、ただし負の数は非対応なので `5 + -3` も不正）
  - 計算式の構文が不正（例: `+ 5`、`5 +`）
- **動作**: 
  - エラーメッセージを表示（例: "Error: Invalid expression"）
  - ユーザーに通知

### 7.4 エラー表示後の動作

- エラーメッセージが表示された後、ユーザーが新たに入力を開始するとエラーがクリアされる
- または、ACボタンでエラーをクリアできる

## 8. 実装上の注意事項

### 8.1 入力制約の実施

- 不正な入力を防ぐため、UIレベルで適切に制約を設ける
  - 例: 演算子が連続して入力できないようにする
  - 例: 閉じ括弧が開き括弧より多くならないようにする

### 8.2 計算精度

- JavaScript の整数演算の精度に注意
- `Number.MAX_SAFE_INTEGER` (9,007,199,254,740,991) を超える場合の処理を考慮

### 8.3 ユーザビリティ

- ボタンのホバー/クリック時の視覚的フィードバックを提供
- キーボード操作時もUIに反映（該当ボタンのハイライト等）
- エラーメッセージは明確で分かりやすい表現にする

## 9. 将来の拡張性

以下の機能は今回の実装には含まれないが、将来的な拡張として考慮する：

- 小数点演算のサポート
- 平方根、べき乗などの関数
- メモリ機能（M+, M-, MR, MC）
- 計算履歴からの値の再利用
- テーマ切り替え（ダークモード等）
