# 非機能要件 (Non-Functional Requirements)

## 1. 技術スタック

### 1.1 フロントエンド

- **言語**: JavaScript (Node.js環境)
- **フレームワーク**: React
- **アーキテクチャ**: フロントエンドのみ（SPA: Single Page Application）
- **バックエンドAPI**: 不要（全ての計算処理はクライアントサイドで実行）

### 1.2 ビルドツール

- Create React App または Vite などの標準的なビルドツールを使用
- ES6+ の機能を活用

### 1.3 スタイリング

- CSS Modules、Styled Components、または通常のCSSを使用
- モダンでシンプルなデザインを実現

## 2. インフラストラクチャ

### 2.1 ホスティング

- **サービス**: Azure Static Web Apps
- **プラン**: 標準プラン (Standard Plan)
- **リージョン**: East Asia

### 2.2 Azure Static Web Apps の構成

- 静的コンテンツの配信
- HTTPS の自動有効化
- カスタムドメイン対応（必要に応じて）

## 3. 環境変数管理

### 3.1 環境変数ファイル

- **ファイル**: `.env` ファイルで管理
- **フォーマット**: Reactの標準的な環境変数規則に従う（`REACT_APP_` プレフィックス）

### 3.2 定義する環境変数

| 変数名 | 説明 | デフォルト値 | 例 |
|--------|------|--------------|-----|
| `REACT_APP_MAX_DIGITS` | 表示可能な最大桁数 | 10 | `REACT_APP_MAX_DIGITS=10` |
| `REACT_APP_HISTORY_COUNT` | 計算履歴の保存件数 | 5 | `REACT_APP_HISTORY_COUNT=5` |

### 3.3 環境変数の管理

- `.env.example` ファイルを用意し、必要な環境変数のテンプレートを提供
- `.env` ファイルは `.gitignore` に追加（機密情報は含まないが、ベストプラクティスとして）
- Azure Static Web Appsの環境変数設定で本番環境の値を管理

## 4. ブラウザサポート

### 4.1 対応ブラウザ

- **Chrome**: 最新版および1つ前のメジャーバージョン
- **Microsoft Edge**: 最新版および1つ前のメジャーバージョン
- **Firefox**: 最新版および1つ前のメジャーバージョン
- **Safari**: 最新版および1つ前のメジャーバージョン

### 4.2 非対応ブラウザ

- Internet Explorer (IE): 全バージョン非対応

### 4.3 確認事項

- モダンなJavaScript機能（ES6+）を使用
- Polyfillは最小限に留める

## 5. デプロイ戦略

### 5.1 ブランチ戦略

- **開発ブランチ**: `1-電卓で四則演算ができるようにする`（現在の実装ブランチ）
- **メインブランチ**: `main`（統合ブランチ）
- **リリースブランチ**: `release`（本番デプロイ用）

### 5.2 デプロイフロー

1. 開発ブランチで機能を実装
2. Pull Requestを作成し、`main` ブランチにマージ
3. `main` ブランチから `release` ブランチにマージ
4. `release` ブランチへのマージをトリガーに自動デプロイが実行される

### 5.3 CI/CD

- **ツール**: GitHub Actions
- **自動化内容**:
  - ビルドの実行
  - テストの実行
  - Azure Static Web Apps へのデプロイ
- **トリガー**: `release` ブランチへのプッシュ/マージ

### 5.4 GitHub Actions ワークフロー

以下を含むワークフローを作成：
- Node.js のセットアップ
- 依存関係のインストール (`npm install`)
- ビルドの実行 (`npm run build`)
- テストの実行 (`npm test`)
- Azure Static Web Apps へのデプロイ

## 6. テスト要件

### 6.1 カバレッジ目標

- **コードカバレッジ**: C0 (Statement Coverage)
  - 全ての実行可能な文が少なくとも一度は実行される
- **目標値**: 80% 以上を推奨

### 6.2 テストフレームワークの選定

以下のフレームワークを比較検討し、最適なものを選択する：

#### オプション1: Jest + React Testing Library
- **メリット**:
  - Reactコミュニティで最も広く使用されている
  - 豊富なドキュメントとコミュニティサポート
  - スナップショットテストのサポート
  - カバレッジレポート機能が組み込み済み
  - Create React App にデフォルトで含まれている
- **デメリット**:
  - 起動がやや遅い（大規模プロジェクトの場合）
  - 設定が複雑になることがある

#### オプション2: Vitest + React Testing Library
- **メリット**:
  - 非常に高速（Viteベース）
  - Jest互換のAPIで移行が容易
  - ES Modulesのネイティブサポート
  - モダンな開発体験
- **デメリット**:
  - Jestほど成熟していない
  - コミュニティがJestより小さい
  - 一部のライブラリでの互換性問題の可能性

#### 推奨
- **Create React App を使用する場合**: Jest + React Testing Library（デフォルト設定を活用）
- **Vite を使用する場合**: Vitest + React Testing Library（パフォーマンス重視）

### 6.3 テストの種類

- **ユニットテスト**: 個別のコンポーネントや関数のテスト
  - 計算ロジックのテスト
  - エラーハンドリングのテスト
  - 入力検証のテスト
- **統合テスト**: コンポーネント間の連携テスト
  - ボタンクリック → 計算実行 → 結果表示の一連の流れ
  - キーボード入力の処理
- **E2Eテスト**: 今回は不要（将来的に検討）

### 6.4 テストの実行

- ローカル環境でのテスト実行: `npm test`
- CI/CD パイプラインでの自動テスト実行
- カバレッジレポートの生成と確認

## 7. パフォーマンス要件

### 7.1 応答時間

- **ボタンクリック/キー入力からの反応**: 100ms 以内
- **計算実行**: 即座（1ms 未満）
- **ページ読み込み時間**: 3秒以内（初回ロード）

### 7.2 最適化

- コンポーネントの適切なメモ化（React.memo, useMemo, useCallback）
- 不要な再レンダリングの防止
- バンドルサイズの最適化（Code Splitting等）

## 8. セキュリティ要件

### 8.1 基本的なセキュリティ

- **HTTPS**: Azure Static Web Apps により自動的に有効化される
- **CSP (Content Security Policy)**: 適切なCSPヘッダーの設定
- **XSS対策**: Reactのデフォルトのエスケープ機能を活用

### 8.2 認証・認可

- **認証機能**: 不要（パブリックなアプリケーション）
- **ユーザーデータの保存**: なし（計算履歴はローカルストレージに保存する場合あり）

### 8.3 一般的な標準への準拠

- OWASP のベストプラクティスに準拠
- 定期的な依存関係の脆弱性チェック（`npm audit`）

## 9. アクセシビリティ

### 9.1 キーボード操作

- 全ての機能がキーボードのみで操作可能
- タブキーによるフォーカス移動のサポート
- Enterキーでの計算実行

### 9.2 スクリーンリーダー対応

- 適切な ARIA ラベルの使用
- ボタンやインタラクティブ要素への適切な role 属性の付与
- 計算結果の読み上げサポート

### 9.3 視覚的アクセシビリティ

- 十分なコントラスト比の確保（WCAG 2.1 AA レベル推奨）
- フォーカス状態の明確な視覚的表示

## 10. 監視・ログ

### 10.1 監視ツール

- **Azure標準の監視**: Azure Static Web Apps の組み込み監視機能を使用
- **追加の監視ツールは不要**: Application Insights などの高度な監視は今回は導入しない

### 10.2 エラーログ

- ブラウザのコンソールにエラーログを出力
- 本番環境でのエラーログは Azure の標準ログに記録

### 10.3 メトリクス

- Azure Static Web Apps のダッシュボードで以下を確認：
  - リクエスト数
  - 帯域幅使用量
  - エラー率

## 11. 開発環境

### 11.1 推奨開発環境

- **エディタ**: Visual Studio Code
- **Node.jsバージョン**: LTS版（18.x または 20.x）
- **パッケージマネージャ**: npm または yarn

### 11.2 開発ツール

- **リンター**: ESLint（Reactのルールセット）
- **フォーマッター**: Prettier
- **型チェック**: PropTypes または TypeScript（オプション）

### 11.3 ローカル開発サーバー

- `npm start` でローカル開発サーバーを起動
- ホットリロード機能の活用

## 12. ドキュメント

### 12.1 必要なドキュメント

- **README.md**: プロジェクトの概要、セットアップ手順、起動方法
- **requirements.md** (本ファイル): 機能要件
- **nonrequirements.md** (このファイル): 非機能要件
- **コードコメント**: 複雑なロジックには適切なコメントを記載

### 12.2 ドキュメントの保守

- 仕様変更時にドキュメントを同時に更新
- Pull Request時にドキュメントの更新も含める

## 13. ブラウザストレージの使用

### 13.1 計算履歴の永続化

- **ストレージ**: localStorage を使用
- **データ形式**: JSON
- **キー名**: `calc-history` など
- **データサイズ**: 最大5件（またはREACT_APP_HISTORY_COUNTで指定された件数）

### 13.2 プライバシー

- 個人情報は保存しない
- ユーザーが履歴をクリアできる機能の提供（オプション）

## 14. 互換性とブラウザポリシー

### 14.1 Progressive Enhancement

- 基本機能は全ての対応ブラウザで動作
- 先進的な機能は段階的に追加（必要に応じて）

### 14.2 Graceful Degradation

- JavaScriptが無効な場合の対応は不要（JavaScriptが必須のアプリ）
- localStorageが利用できない場合は計算履歴機能を無効化

## 15. ライセンスと著作権

- **ライセンス**: MIT License または組織のポリシーに従う
- **サードパーティライブラリ**: ライセンスの互換性を確認

## 16. 保守性

### 16.1 コード品質

- 一貫したコーディングスタイルの維持（ESLint、Prettier）
- コンポーネントの適切な分割と再利用性
- 明確な命名規則の使用

### 16.2 依存関係の管理

- 定期的な依存関係の更新
- 脆弱性のある依存関係の迅速な修正
- 不要な依存関係の削除

## 17. スケーラビリティ

### 17.1 将来の拡張

- コンポーネント設計は拡張を考慮
- 新機能の追加が容易なアーキテクチャ
- 機能のモジュール化

### 17.2 トラフィック

- Azure Static Web Apps の標準プランで十分なトラフィックに対応可能
- 必要に応じてCDNの活用（Azure Static Web Apps に組み込み済み）
